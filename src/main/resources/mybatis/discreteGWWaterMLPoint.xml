<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="discreteGWMLPoint">
	<resultMap id="pointResult" type="WaterMLPoint">
		<result property="monLocIdentifier" column="monLocIdentifier"/>
		<result property="resultDateTimeUTC" column="resultDateTimeUTC"/>
		<result property="resultValue" column="resultValue"/>
		<result property="resultUnit" column="resultUnit"/>
		<result property="resultAccuracy" column="resultAccuracy"/>
		<result property="resultAccuracyUnit" column="resultAccuracyUnit"/>
		<result property="verticalDatum" column="verticalDatum"/>
		<result property="pcode" column="pcode"/>
		<result property="qualifiersAsJson" column="qualifiersAsJson"/>
		<result property="pcodeDesc" column="pcodeDesc"/>
		<result property="status" column="status"/>
	</resultMap>

	<select id="getDiscreteGWMLPoint" parameterType="map" resultMap="pointResult" fetchSize="500">
		select
			monitoring_location_identifier "monLocIdentifier",
			date_measured_raw "resultDateTimeUTC", /* timestamp of the UTC time */
			display_result "resultValue",
			parm.parm_unt_tx "resultUnit",
			level_accuracy "resultAccuracy",
			parm.parm_unt_tx "resultAccuracyUnit", /* We don't have a accuracy unit - do we know its the same? */
			vertical_datum_code "verticalDatum",
			parameter_code "pcode",
		    parm.parm_ds "pcodeDesc",
			result_measure_qualifiers::text "qualifiersAsJson",
			approval_level_description "status"
		from nwis.discrete_ground_water_aqts dgw left join nwis.parm parm
			on dgw.parameter_code = parm.parm_cd
		where
			dgw.monitoring_location_identifier = #{featureId,jdbcType=VARCHAR}
		order by "monLocIdentifier", "pcode", "resultDateTimeUTC"
	</select>
</mapper>
